pre-config:
  commands:
    - "target remote :11111"
    - "set pagination off"
config:
  timeout: 240
  collect:
    - name: "handling_model_torque_curve"
      points:
        - locspec: "*0x004fdac0"
          values:
            - &rpm_arg_edx
              name: "rpm"
              expr: "$edx"
              format: "%u"
        - locspec: "*0x004fdbec"
          values:
            - &result_st0
              name: "result"
              expr: "$st0"
              format: "%f"
    - name: "something_with_ang_vel"
      points:
        - locspec: "*0x00502e70"
          values:
            - &local_linear_velocity_x
              name: "linear_velocity_x"
              expr: "*((float*)($eax + 0x434))"
              format: "%f"
            - &local_linear_velocity_y
              name: "linear_velocity_y"
              expr: "*((float*)($eax + 0x438))"
              format: "%f"
            - &local_linear_velocity_z
              name: "linear_velocity_z"
              expr: "*((float*)($eax + 0x43c))"
              format: "%f"
            - &global_angular_velocity_y
              name: "angular_velocity_y"
              expr: "*((float*)($eax + 0x5c))"
              format: "%f"
            - &current_gear
              name: "gear"
              expr: "*((uint8_t*)($eax + 0x453))"
              format: "%u"
            - &inertia_inv_y
              name: "inertia_inv_y"
              expr: "*((float*)($eax + 0x74))"
              format: "%f"
            - &mass
              name: "mass"
              expr: "*((float*)($eax + 0x20))"
              format: "%f"
            - &airborne_counter
              name: "airborne_counter"
              expr: "*((uint16_t*)($eax + 0x1a4))"
              format: "%d"
        - locspec: "*0x00502f31"
          values:
            - *result_st0
    - name: "steering_angle"
      points:
        - locspec: "*0x005014e0"
          values:
            - *airborne_counter
            - *local_linear_velocity_x
            - *local_linear_velocity_y
            - *local_linear_velocity_z
            - &turn_angle
              name: "turn_angle"
              expr: "*((uint32_t*)($eax + 0x464))"
              format: "%d"
            - &handbrake
              name: "handbrake"
              expr: "*((uint8_t*)($eax + 0x455))"
              format: "%u"
        - locspec: "*0x005017aa"
          values:
            - *result_st0
    - name: "traction_drag"
      points:
        - locspec: "*0x004ffb2e"
          values:
            - *local_linear_velocity_x
            - *local_linear_velocity_y
            - *local_linear_velocity_z
        - locspec: "*0x004ffbba"
          values:
            - name: "result"
              expr: "*((float*)($ebp - 0x20))"
              format: "%f"
    - name: "traction_drivetrain"
      points:
        - locspec: "*0x004fffc3"
          values:
            - *rpm_arg_edx
            - *current_gear
        - locspec: "*0x0050005d"
          values:
            - name: "result"
              expr: "*((float*)($ebp - 0x44))"
              format: "%f"

    - name: "wheel_force_calculations"
      points:
        - locspec: "*0x00500f20"
          values:
            - &surface_type
              name: "surface_type"
              expr: "*((uint32_t*)($eax + 0xe0))"
              format: "%u"
            - name: "lateral_grip"
              expr: "*((float*)($edx + 0x4))"
              format: "%f"
            - name: "wheel_steering"
              expr: "*((float*)($edx + 0xc))"
              format: "%f"
            - *local_linear_velocity_x
            - *local_linear_velocity_y
            - *local_linear_velocity_z
            - *global_angular_velocity_y
            - *mass
            - *inertia_inv_y
            - name: "wheel_traction"
              expr: "*((float*)($edx))"
              format: "%f"
            - *current_gear
            - &throttle
              name: "throttle"
              expr: "*((float*)($eax + 0x550))"
              format: "%f"
            - *handbrake
            - name: "wheel_is_front"
              expr: "*((uint32_t*)($edx + 0x28))"
              format: "%u"
            - *turn_angle
            - *airborne_counter
        - locspec: "*0x00501450"
          values:
            - name: "lateral_force"
              expr: "*((float*)($eax + 0x1c))"
              format: "%f"
            - name: "longitudal_force"
              expr: "*((float*)($eax + 0x24))"
              format: "%f"
    - name: "wheel_resistance"
      points:
        - locspec: "*0x00501efc"
          values:
            - *local_linear_velocity_x
            - *local_linear_velocity_y
            - *local_linear_velocity_z
            - *global_angular_velocity_y
            - *mass
            - *inertia_inv_y
            - *airborne_counter
            - *current_gear
            - name: "result_lateral"
              expr: "*((float*)($edx + 0x10))"
              format: "%f"
            - name: "result_longitudal"
              expr: "*((float*)($edx + 0x18))"
              format: "%f"
            - name: "wheel_type"
              expr: "*((uint32_t*)($ebp + 0x76))"
              format: "%u"
    - name: "wheel_steering_acceleration"
      points:
        - locspec: "*0x00501221"
          values:
            - name: "lateral_grip"
              expr: "*((float*)($eax + 0x4))"
              format: "%f"
            - name: "wheel_is_front"
              expr: "*((uint32_t*)($eax + 0x28))"
              format: "%u"
            - name: "result_lateral"
              expr: "*((float*)($eax + 0x10))"
              format: "%f"
            - name: "result_longitudal"
              expr: "*((float*)($eax + 0x18))"
              format: "%f"
        - locspec: "*0x0050123b"
          values:
            - *airborne_counter
            - *current_gear
        - locspec: "*0x00501268"
          values:
            - *result_st0
    - name: "wheel_turned_steering_acceleration"
      points:
        - locspec: "*0x00501221"
          values:
            - name: "lateral_grip"
              expr: "*((float*)($eax + 0x4))"
              format: "%f"
            - name: "wheel_is_front"
              expr: "*((uint32_t*)($eax + 0x28))"
              format: "%u"
        - locspec: "*0x0050123b"
          values:
            - *current_gear
            - *global_angular_velocity_y
            - *local_linear_velocity_x
            - *local_linear_velocity_y
            - *local_linear_velocity_z
            - *mass
            - *inertia_inv_y
            - *turn_angle
            - *airborne_counter
            - *handbrake
        - locspec: "*0x00501268"
          values:
            - *result_st0
    - name: "wheel_forces_sloped"
      points:
        - locspec: "*0x00501f35"
          values:
            - &road_basis_normal_y
              name: "road_basis_normal_y"
              expr: "*((float*)($edx + 0x148 + 0xc + 0x4))"
              format: "%f"
            - name: "wheel_lateral_force"
              expr: "*((float*)($ebp + $eax - 0xae))"
              format: "%f"
            - name: "result_lateral"
              expr: "$st0"
              format: "%f"
        - locspec: "*0x00501f5b"
          values:
            - name: "wheel_longitudal_force"
              expr: "*((float*)($ebp + $eax - 0xa6))"
              format: "%f"
            - name: "result_longitudal"
              expr: "$st0"
              format: "%f"
    - name: "wheel_forces_to_linear_acceleration"
      points:
        - locspec: "*0x00501fe8"
          values:
            - &handling_model_wheel_0_longitudal_force
              name: "wheel_0_longitudal_force"
              expr: "*((float*)($ebp - 0xa6))"
              format: "%f"
            - &handling_model_wheel_1_longitudal_force
              name: "wheel_1_longitudal_force"
              expr: "*((float*)($ebp - 0x76))"
              format: "%f"
            - &handling_model_wheel_2_longitudal_force
              name: "wheel_2_longitudal_force"
              expr: "*((float*)($ebp - 0x46))"
              format: "%f"
            - &handling_model_wheel_3_longitudal_force
              name: "wheel_3_longitudal_force"
              expr: "*((float*)($ebp - 0x16))"
              format: "%f"
            - &handling_model_wheel_0_lateral_force
              name: "wheel_0_lateral_force"
              expr: "*((float*)($ebp - 0xae))"
              format: "%f"
            - &handling_model_wheel_1_lateral_force
              name: "wheel_1_lateral_force"
              expr: "*((float*)($ebp - 0x7e))"
              format: "%f"
            - &handling_model_wheel_2_lateral_force
              name: "wheel_2_lateral_force"
              expr: "*((float*)($ebp - 0x4e))"
              format: "%f"
            - &handling_model_wheel_3_lateral_force
              name: "wheel_3_lateral_force"
              expr: "*((float*)($ebp - 0x1e))"
              format: "%f"
            - &local_linear_acceleration_x
              name: "local_linear_acceleration_x"
              expr: "*((float*)($eax + 0x428))"
              format: "%f"
            - &local_linear_acceleration_z
              name: "local_linear_acceleration_z"
              expr: "*((float*)($eax + 0x428 + 0x8))"
              format: "%f"
    - name: "wheel_forces_to_angular_acceleration"
      points:
        - locspec: "*0x00501fe8"
          values:
            - *handling_model_wheel_0_longitudal_force
            - *handling_model_wheel_1_longitudal_force
            - *handling_model_wheel_2_longitudal_force
            - *handling_model_wheel_3_longitudal_force
            - *handling_model_wheel_0_lateral_force
            - *handling_model_wheel_1_lateral_force
            - *handling_model_wheel_2_lateral_force
            - *handling_model_wheel_3_lateral_force
            - *mass
            - *inertia_inv_y
        - locspec: "*0x005021d9"
          values:
            - *result_st0
    - name: "wheel_surface_factor"
      points:
        - locspec: "*0x004ff705"
          values:
            - *road_basis_normal_y
        - locspec: "*0x004ff85c"
          values:
            - name: "road_surface"
              expr: "$eax"
              format: "%d"
        - locspec: "*0x004ff815"
          values:
            - name: "result"
              expr: "*((float*)($eax + 0x528))"
              format: "%f"
    - name: "wheel_downforce_factor"
      points:
        - locspec: "*0x004ffa1a"
          force_capture: true
          values:
            - *local_linear_velocity_z
            - &wheel_0_downforce_factor
              name: "wheel_0_downforce_factor"
              expr: "*((float*)($eax + 0x518))"
              format: "%f"
            - &wheel_1_downforce_factor
              name: "wheel_1_downforce_factor"
              expr: "*((float*)($eax + 0x51c))"
              format: "%f"
            - &wheel_2_downforce_factor
              name: "wheel_2_downforce_factor"
              expr: "*((float*)($eax + 0x520))"
              format: "%f"
            - &wheel_3_downforce_factor
              name: "wheel_3_downforce_factor"
              expr: "*((float*)($eax + 0x524))"
              format: "%f"
        - locspec: "*0x004ff9b6"
          force_capture: true
          values:
            - *local_linear_velocity_z
            - *wheel_0_downforce_factor
            - *wheel_1_downforce_factor
            - *wheel_2_downforce_factor
            - *wheel_3_downforce_factor
    - name: "wheel_longitudal_force"
      points:
        - locspec: "*0x00500f20"
          values:
            - *current_gear
            - *throttle
            - *handbrake
            - *local_linear_velocity_x
            - *local_linear_velocity_z
        - locspec: "*0x00500f9f"
          values:
            - &wheel_traction
              name: "wheel_traction"
              expr: "*((float*)($eax))"
              format: "%f"
            - name: "result_lateral"
              expr: "*((float*)($eax + 0x10))"
              format: "%f"
            - name: "result_longitudal"
              expr: "*((float*)($eax + 0x18))"
              format: "%f"
            - &wheel_is_front
              name: "wheel_is_front"
              expr: "*((uint32_t*)($eax + 0x28))"
              format: "%u"
            - name: "lateral_grip"
              expr: "*((float*)($eax + 0x4))"
              format: "%f"
        - locspec: "*0x0050140a"
          values:
            - name: "longitudal_force"
              expr: "*((float*)($eax))"
              format: "%f"
    - name: "wheel_force_postprocess"
      points:
        - locspec: "*0x00500aff"
          values:
            - *wheel_is_front
            - name: "lateral_force"
              expr: "*((float*)($eax + 0x1c))"
              format: "%f"
            - name: "longitudal_force"
              expr: "*((float*)($eax + 0x24))"
              format: "%f"
            - name: "lateral_grip"
              expr: "*((float*)($eax + 0x4))"
              format: "%f"
        - locspec: "*0x00500b6a"
          values:
            - *surface_type
            - *local_linear_velocity_x
            - *local_linear_velocity_z
            - *current_gear
            - *throttle
            - &rpm
              name: "rpm"
              expr: "*((uint32_t*)($eax + 0x4e0))"
              format: "%u"
            - &road_surface_type
              name: "road_surface_type"
              expr: "*((uint32_t*)($eax + 0x1d8))"
              format: "%u"
        - locspec: "*0x00500e4d"
          values:
            - name: "result_lateral"
              expr: "*((float*)($eax + 0x1c))"
              format: "%f"
            - name: "result_longitudal"
              expr: "*((float*)($eax + 0x24))"
              format: "%f"
    - name: "turning_circle"
      points:
        - locspec: "*0x005022e6"
          values:
            - *throttle
            - &brake
              name: "brake"
              expr: "*((float*)($eax + 0x54c))"
              format: "%f"
            - *turn_angle
            - *local_linear_velocity_x
            - *local_linear_velocity_z
            - *local_linear_velocity_y
            - &local_angular_velocity_y
              name: "angular_velocity_y"
              expr: "*((float*)($eax + 0x444))"
              format: "%f"
            - *current_gear
            - &global_linear_velocity_x
              name: "global_linear_velocity_x"
              expr: "*((float*)($eax + 0x14))"
              format: "%f"
            - &global_linear_velocity_y
              name: "global_linear_velocity_y"
              expr: "*((float*)($eax + 0x18))"
              format: "%f"
            - &global_linear_velocity_z
              name: "global_linear_velocity_z"
              expr: "*((float*)($eax + 0x1c))"
              format: "%f"
            - &slip_angle
              name: "slip_angle"
              expr: "*((float*)($eax + 0x500))"
              format: "%f"
        - locspec: "*0x005022fd"
          values:
            - name: "result_global_linear_velocity_x"
              expr: "*((float*)($eax + 0x14))"
              format: "%f"
            - name: "result_global_linear_velocity_y"
              expr: "*((float*)($eax + 0x18))"
              format: "%f"
            - name: "result_global_linear_velocity_z"
              expr: "*((float*)($eax + 0x1c))"
              format: "%f"
            - name: "result_angular_velocity_y"
              expr: "*((float*)($eax + 0x444))"
              format: "%f"
post-config:
  commands:
    - "continue"
