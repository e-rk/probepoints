pre-config:
  commands:
    - "target remote :11111"
    - "set pagination off"
config:
  timeout: 240
  collect:
    - name: "handling_model_torque_curve"
      points:
        - locspec: "*0x004fdac0"
          values:
            - &rpm_arg_edx
              name: "rpm"
              expr: "$edx"
              format: "%u"
        - locspec: "*0x004fdbec"
          values:
            - &result_st0
              name: "result"
              expr: "$st0"
              format: "%f"
    - name: "something_with_ang_vel"
      points:
        - locspec: "*0x00502f0c"
          values:
            - &local_linear_velocity_x
              name: "linear_velocity_x"
              expr: "*((float*)($eax + 0x434))"
              format: "%f"
            - &local_linear_velocity_y
              name: "linear_velocity_y"
              expr: "*((float*)($eax + 0x438))"
              format: "%f"
            - &local_linear_velocity_z
              name: "linear_velocity_z"
              expr: "*((float*)($eax + 0x43c))"
              format: "%f"
            - &global_angular_velocity_y
              name: "angular_velocity_y"
              expr: "*((float*)($eax + 0x5c))"
              format: "%f"
            - &current_gear
              name: "gear"
              expr: "*((uint8_t*)($eax + 0x453))"
              format: "%u"
            - &inertia_inv_y
              name: "inertia_inv_y"
              expr: "*((float*)($eax + 0x74))"
              format: "%f"
            - &mass
              name: "mass"
              expr: "*((float*)($eax + 0x20))"
              format: "%f"
        - locspec: "*0x00502f31"
          values:
            - *result_st0
    - name: "steering_angle"
      points:
        - locspec: "*0x005014e0"
          values:
            - *local_linear_velocity_x
            - *local_linear_velocity_y
            - *local_linear_velocity_z
            - &turn_angle
              name: "turn_angle"
              expr: "*((uint32_t*)($eax + 0x464))"
              format: "%d"
            - &handbrake
              name: "handbrake"
              expr: "*((uint8_t*)($eax + 0x455))"
              format: "%u"
        - locspec: "*0x005017aa"
          values:
            - *result_st0
    - name: "traction_drag"
      points:
        - locspec: "*0x004ffb2e"
          values:
            - *local_linear_velocity_x
            - *local_linear_velocity_y
            - *local_linear_velocity_z
        - locspec: "*0x004ffbba"
          values:
            - name: "result"
              expr: "*((float*)($ebp - 0x20))"
              format: "%f"
    - name: "traction_drivetrain"
      points:
        - locspec: "*0x004fffc3"
          values:
            - *rpm_arg_edx
            - *current_gear
        - locspec: "*0x0050005d"
          values:
            - name: "result"
              expr: "*((float*)($ebp - 0x44))"
              format: "%f"

    - name: "wheel_force_calculations"
      points:
        - locspec: "*0x00500f20"
          values:
            - &surface_type
              name: "surface_type"
              expr: "*((uint32_t*)($eax + 0xe0))"
              format: "%u"
            - name: "lateral_grip"
              expr: "*((float*)($edx + 0x4))"
              format: "%f"
            - name: "wheel_steering"
              expr: "*((float*)($edx + 0xc))"
              format: "%f"
            - *local_linear_velocity_x
            - *local_linear_velocity_y
            - *local_linear_velocity_z
            - *global_angular_velocity_y
            - *mass
            - *inertia_inv_y
            - name: "wheel_traction"
              expr: "*((float*)($edx))"
              format: "%f"
            - *current_gear
            - &throttle
              name: "throttle"
              expr: "*((float*)($eax + 0x550))"
              format: "%f"
            - *handbrake
            - name: "wheel_is_front"
              expr: "*((uint32_t*)($edx + 0x28))"
              format: "%u"
            - *turn_angle
        - locspec: "*0x00501450"
          values:
            - name: "lateral_force"
              expr: "*((float*)($eax + 0x1c))"
              format: "%f"
            - name: "longitudal_force"
              expr: "*((float*)($eax + 0x24))"
              format: "%f"
    - name: "wheel_resistance"
      points:
        - locspec: "*0x00501efc"
          values:
            - *local_linear_velocity_x
            - *local_linear_velocity_y
            - *local_linear_velocity_z
            - *global_angular_velocity_y
            - *mass
            - *inertia_inv_y
            - *current_gear
            - name: "result_lateral"
              expr: "*((float*)($edx + 0x10))"
              format: "%f"
            - name: "result_longitudal"
              expr: "*((float*)($edx + 0x18))"
              format: "%f"
            - name: "wheel_is_front"
              expr: "*((uint32_t*)($edx + 0x28))"
              format: "%u"
    - name: "wheel_steering_acceleration"
      points:
        - locspec: "*0x00501221"
          values:
            - name: "lateral_grip"
              expr: "*((float*)($eax + 0x4))"
              format: "%f"
            - name: "wheel_is_front"
              expr: "*((uint32_t*)($eax + 0x28))"
              format: "%u"
            - name: "result_lateral"
              expr: "*((float*)($eax + 0x10))"
              format: "%f"
            - name: "result_longitudal"
              expr: "*((float*)($eax + 0x18))"
              format: "%f"
        - locspec: "*0x0050123b"
          values:
            - *current_gear
        - locspec: "*0x00501268"
          values:
            - *result_st0
    - name: "wheel_turned_steering_acceleration"
      points:
        - locspec: "*0x00501221"
          values:
            - name: "lateral_grip"
              expr: "*((float*)($eax + 0x4))"
              format: "%f"
            - name: "wheel_is_front"
              expr: "*((uint32_t*)($eax + 0x28))"
              format: "%u"
        - locspec: "*0x0050123b"
          values:
            - *current_gear
            - *global_angular_velocity_y
            - *local_linear_velocity_x
            - *local_linear_velocity_y
            - *local_linear_velocity_z
            - *mass
            - *inertia_inv_y
            - *turn_angle
            - *handbrake
        - locspec: "*0x00501268"
          values:
            - *result_st0
post-config:
  commands:
    - "continue"
